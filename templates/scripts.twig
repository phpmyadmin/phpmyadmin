{% for file in files %}
  <script data-cfasync="false" type="text/javascript" src="{{ base_dir }}{{ not (file.filename starts with 'index.php') ? 'js/' -}}
    {{- file.filename starts with 'vendor/' or file.filename starts with 'index.php' ? file.filename : 'dist/' ~ file.filename -}}
    {{- '.php' in file.filename ? get_common(file.params|merge({'v': version})) : '?v=' ~ version|url_encode }}"></script>
{% endfor %}

<script data-cfasync="false" type="text/javascript">
// <![CDATA[
{{ code|raw }}
{% if files is not empty %}
{% for file in files %}
window.AJAX.scriptHandler.add('{{ file.filename|escape('js') }}', {{ file.has_onload ? 'true' : 'false' }});
{% endfor %}

$(function() {
{% for file in files %}
  {% if file.has_onload %}
  window.AJAX.fireOnload('{{ file.filename|escape('js') }}');
  {% endif %}
{% endfor %}
});
{% endif %}
// ]]>
</script>
